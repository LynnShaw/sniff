# sniff
sniff use C language.
C语言实现的简单嗅探器。
基于winpcap。


原理简介:
嗅探器程序一般包括内核部分和用户分析部分。其中内核部分负责从网络中捕获和过滤数据。用户分析部分负责界面、数据转化与处理、格式化、协议分析，如果在内核没有过滤数据包，在这里还要对数据进行过滤。一个较为完整的基于网络监听和 过滤的程序一般包括以下步骤：数据包捕获、数据包过滤与分解、数据分析。数据包捕获常用的方法有两种： 
（1）通过设置硬路由器的监听端口； 
（2）利用以太网络的广播特性。
这种方式必须将网卡设置为混杂（ promiscuous） 模式。监听程序工作在网络环境的底三层，可以拦截所有经过该机器的网络上传送的 数据，然后将这些数据做相应处理，可以实时分析这些数据的内容，进而分析网络当前状态和整体布局。基于 windows 的数据包捕获方案有以下几种： 使用原始套接字（ row socket）机制。方法简单，但功能有限，只能捕获较高层的数据包； 直接连接调用NDIS库函数，这种方法功能非常强大，但是比较危险，很可能导致系统崩溃和网络瘫痪；使用或者自行编写中间层驱动程序，这是微软公司推荐使用的一种方法，微软提供的 win2000 DDK 中也提供了几个这样的驱动程序。在具体的实现方式上可分为用户级和内核级两类。其中内核级主要是 TDI 捕获过滤驱动程序，NDIS 中间层捕获过滤驱动程序， NDIS 捕获过滤钩子驱动程序等，它们都是利用网络驱动来实现的；而 用户级的包括 SPI 接口， Windows2000 包捕获过滤接口等;使用或自行编写协议驱动程序;使用第三方捕获组件或者库，比如 Winpcap。 
捕获数据包后要进行的工作是对其进行包过滤与分解，就是在海量的数据里面找我们感兴趣的内容。一些基础的过滤规则如下：
站过滤：专门筛选出来自一台主机或者服务器的数据； 
协议过滤：根据不同的协议来筛选数据，例如：选择 TCP 数据而非 UDP 数据； 
服务过滤：根据端口号来选择特定数据包； 
通用过滤：通过数据包中某一特定位置开始，选择具有某些共同数据特征的数据包； 
过滤完成后，必须进行数据分析，这一部分就是对已经捕获的数据包进行各种分析，比如网络流量分析，数据包中信息分析，敏感信息提取分析等，其功能取决于系统要达到的目的。        
WinPcap 是 Windows 平台下一个专业网络数据包捕获开发包，是为 Libpcap 在 Windows 平台下实现数据包的捕获而设计的。 Libcap（ Winpcap 是其 windows 版本） 可以提供与平台无关的接口，而且操作简单，它是基于改进的 BPF（ Berkeley Packet Filter），该软件来自 Berkeley 的 Lawrence National Laboratory 研究院。使用 Winpcap 包过程比较规范。 
基于 Libcap/Winpcap 库的基本使用流程比较规范，一般为： 使用 pcap_lookupdev 获取设备；使用 pcap_lookupnet 获取网络地址和子网掩码；使用pcap_open_live 打开设备；使用 pcap_complile 编译过滤规则；使用 pcap_setfilter 设置过滤规则； 使用 pcap_loop 循环捕获数据包，在其中调用相应处理函数；使用 pcap_close 关闭设备句柄。
